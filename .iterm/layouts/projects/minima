#!/usr/bin/env osascript -l JavaScript

function run() {
  Minima.run("~/Dev/Projects/minima.pro/minima", {
    root:
      "export GOPATH=$(pwd) PATH=$(pwd)/bin:$PATH; atom . src/client src/server",
    client: "scripts/start.client",
    server: "scripts/start.server",
    services: "scripts/start.services"
  });
}

const iTerm = Application("iTerm");
const Utils = Library("utils");

iTerm.includeStandardAdditions = true;
iTerm.activate();

const Minima = {
  run(path, cmd) {
    const container = iTerm.createWindowWithDefaultProfile();

    const rootSession = container.currentSession;
    const clientSession = rootSession.splitHorizontallyWithDefaultProfile();
    const serverSession = clientSession.splitVerticallyWithDefaultProfile();
    const servicesSession = serverSession.splitVerticallyWithDefaultProfile();

    Utils.prepareSessions(path, [
      rootSession,
      clientSession,
      serverSession,
      servicesSession
    ]);

    rootSession.write({ text: cmd.root, newline: false });
    clientSession.write({ text: cmd.client, newline: false });
    serverSession.write({ text: cmd.server, newline: false });
    servicesSession.write({ text: cmd.services, newline: false });
    rootSession.select();
  }
};
