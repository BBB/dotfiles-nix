#!/usr/bin/env osascript -l JavaScript

function run() {
  Minima.run("~/Dev/Projects/minima/minima", {
    root: "atom .",
    core: "cd core",
    web: "cd web",
    log: "scripts/up",
  });
}

const iTerm = Application("iTerm");
const Utils = Library("utils");

iTerm.includeStandardAdditions = true;
iTerm.activate();

const Minima = {
  run(path, cmd) {
    const container = iTerm.createWindowWithDefaultProfile();

    const rootSession = container.currentSession;
    const coreSession = rootSession.splitHorizontallyWithDefaultProfile();
    const logSession = coreSession.splitHorizontallyWithDefaultProfile();
    const webSession = coreSession.splitVerticallyWithDefaultProfile();

    Utils.prepareSessions(path, [
      rootSession,
      coreSession,
      webSession,
      logSession,
    ]);

    rootSession.write({ text: cmd.root, newline: false });
    coreSession.write({ text: cmd.core, newline: true });
    webSession.write({ text: cmd.web, newline: true });
    logSession.write({ text: cmd.log, newline: false });
    rootSession.select();
  }
};
